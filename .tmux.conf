#===============================================================================
# Allow for Copying to Clipboard ===============================================
set-option -g default-command "reattach-to-user-namespace -l zsh"

#===============================================================================
# Misc =========================================================================
set -s escape-time 1               # make keys more responsive (from TMUX book)
bind-key l send-keys 'C-l'         # restore 'clear screen' to prefix + l

unbind C-b                         # unbind regular prefix
set -g prefix C-a                  # set prefix to ctrl + a

set -g default-terminal 'screen-256color' # improve colors

bind r source-file ~/.tmux.conf \; display "Reloaded ~/.tmux.conf." # Reload tmux conf. from: https://github.com/philtr/dotfiles/blob/master/tmux/tmux.conf#L12

#===============================================================================
# Window Management ============================================================

# Splits -----------------------------------------------------------------------
bind-key | split-window -h  # vertical split
bind-key - split-window     # horizontal split

# Window Switching (Vim Tmux Navigator) ----------------------------------------
bind -n C-h run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim(diff)?$' && tmux send-keys C-h) || tmux select-pane -L"
bind -n C-j run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim(diff)?$' && tmux send-keys C-j) || tmux select-pane -D"
bind -n C-k run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim(diff)?$' && tmux send-keys C-k) || tmux select-pane -U"
bind -n C-l run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim(diff)?$' && tmux send-keys C-l) || tmux select-pane -R"
bind -n C-\ run "(tmux display-message -p '#{pane_current_command}' | grep -iqE '(^|\/)vim(diff)?$' && tmux send-keys 'C-\\') || tmux select-pane -l"

# Window Resizing --------------------------------------------------------------
bind -r H resize-pane -L 5         # prefix + H => Move Left
bind -r J resize-pane -D 5         # prefix + J => Move Down
bind -r K resize-pane -U 5         # prefix + K => Move Up
bind -r L resize-pane -R 5         # prefix + L => Move Right

#===============================================================================
# Vim style Copy Mode: ( prefix + [ ) ==========================================
setw -g mode-keys vi                      # set vi-keys in copy mode
bind-key -t vi-copy v begin-selection     # enable visual mode
bind-key -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy" # copy on yank
unbind -t vi-copy Enter                   # unbind enter in copy mode
bind-key -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy" # copy on enter

#===============================================================================
# Mouse Support (iTerm) ========================================================
set-window-option -g mode-mouse on
set-option -g mouse-select-pane on
set-option -g mouse-resize-pane on
set-option -g mouse-select-window on

#===============================================================================
# Status Bar ==================================================================
bind-key / set status                    # use Prefix-/ to toggle status bar

set -g status-left-length 100
set -g status-right-length 100
set -g status-utf8 on                    # enable UTF-8 characters in status bar
set -g status-interval 1                 # update once a second

# Colors -----------------------------------------------------------------------
setw -g window-status-current-fg green   # current window text color: green
set -g status-fg white                   # status color: white
set -g status-bg default                 # status bg color: default
set -g status-attr default               # status attribute color: default

# Content ----------------------------------------------------------------------
set -g status-left " ⨠  #(whoami) {{#S}} "            # ⨠ thewatts
set -g status-right "#(cat ~/.thyme-tmux) #[fg=brightcyan][%H:%M]#[fg=default]#(battery -pt) " # thyme time battery
setw -g window-status-current-format " ⚫︎ #W {#I} " # current:      ⚫︎ { window name }
setw -g window-status-format " ⚪︎ #W {#I} "         # non-current : ⚪︎ { window name }
